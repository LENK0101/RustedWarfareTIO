
[core]
name: 超时空传送仪
price: 0
maxHp: 1300
mass: 50000
radius: 60

copyFrom: ROOT:\共享文件\3类\阵营建筑共同.template
displayText: Allied Chronosphere
displayText_zh: 超时空传送仪
displayDescription: Funds: -3000\nPower: -200\nSpecial: Super auxiliary equipment.\nLimited to one.\nDestroy creatures in range when teleporting.\n\nAlso effective for friendly vehicles.\nNeed time to prepare.
displayDescription_zh: 资金花费：3000\n电力占用：200\n特殊：超级辅助\n限造一台\n传送载具\n传送时对敌我生物伤害很高\n可以传送友军载具\n需要时间准备
borrowResourcesWhileAlive: 电力=200
tags: 原始护甲, 建筑重甲, 建筑, 超时空传送仪, 占领, 可入侵, 空下, allied
fogOfWarSightRange: 17
isBuilding: true
footprint: -3,-1,3,1
#displayFootprint: -4,-1,4,2
constructionFootprint: -4,-1,4,2
buildSpeed: 0
selfBuildRate: 1s
isLockedIfGameModeNoNuke: true
effectOnDeath: CUSTOM:土坑3, CUSTOM:土坑2, CUSTOM:土坑, CUSTOM:炸毁, CUSTOM:炸毁2, CUSTOM:炸毁3


[graphics]
image:        超时空传送仪.png
icon_build: ROOT:盟军\单位图标\超时空传送仪.png

default_frame: 0
total_frames: 7
imageScale: 0.8
image_offsetX: -10
image_offsetY: -42
#scaleImagesTo:80
#image_wreak:  NONE
#animation_idle_start: 8
#animation_idle_end: 8
#animation_idle_speed: 6
#whenBeingBuiltMakeTransparentTill: 0


[attack]
canAttack: true
canAttackFlyingUnits: false
canAttackLandUnits: if self.isControlledByAI()
canAttackUnderwaterUnits: false
turretMultiTargeting: true


[movement]
movementType: BUILDING


[turret_传送]
x: 0
y: 0

canShoot: false
limitingRange: 9999
#shoot_sound: nuke_launch
#shoot_sound_vol:0.08
projectile: 传送


[turret_传送2]
x: 0
y: 0

canShoot: false
limitingRange: 9999
projectile: 传送2


[turret_传送2-Ai]
x: 0
y: 0

canAttackCondition: if (numberOfUnitsInEnemyTeam(withTag='车厂', greaterThan=0) or numberOfUnitsInEnemyTeam(withTag='基地', greaterThan=0) or numberOfUnitsInEnemyTeam(withTag='兵营', greaterThan=0) or numberOfUnitsInEnemyTeam(withTag='机场', greaterThan=0)) and not self.hasFlag(id=1) and self.queueSize(empty=true) and self.resource(type="电力",greaterThan=0) and self.globalTeamTags(includes='Ai传送') and self.resource(type='超时空计时', empty=true)
canOnlyAttackUnitsWithTags: 车厂, 基地, 兵营, 机场
limitingRange: 9999
resourceUsage: setFlag=1
projectile: 传送2-Ai


[turret_传送2-Ai2]
x: 0
y: 0

canAttackCondition: if not numberOfUnitsInEnemyTeam(withTag='车厂', greaterThan=0) and not numberOfUnitsInEnemyTeam(withTag='基地', greaterThan=0) and not numberOfUnitsInEnemyTeam(withTag='兵营', greaterThan=0) and not numberOfUnitsInEnemyTeam(withTag='机场', greaterThan=0) and not self.hasFlag(id=1) and self.queueSize(empty=true) and self.resource(type="电力",greaterThan=0) and self.globalTeamTags(includes='Ai传送') and self.resource(type='超时空计时', empty=true)
canOnlyAttackUnitsWithoutTags: 车厂, 基地, 兵营, 机场
limitingRange: 9999
resourceUsage: setFlag=1
projectile: 传送2-Ai


[projectile_传送]
directDamage: 0
life: 60

instant: true
targetGround: true
explodeEffect: NONE
spawnUnit: 超时空传送, 超时空控制


[projectile_传送2]
directDamage: 0
life: 60

@copyFromSection: projectile_传送
spawnUnit: 超时空传送2


[projectile_传送2-Ai]
directDamage: 0
life: 60

@copyFromSection: projectile_传送
#targetGroundSpread: 100
spawnUnit: 超时空传送2*10(offsetRandomX=200, offsetRandomY=200, skipIfOverlapping=true)


[action_显示计时]
text: Countdown
text_zh: 倒计时
price: 超时空计时=1
displayRemainingStockpile: true
displayType: rally
isActive: false
isAlsoViewableByAllies: true
#isVisible: if not self.resource(type='临时救援计时', empty=true)
#addResources: 超时空计时=-1
showMessageToAllPlayers: 触发


[action_卖钱2]
#autoTrigger: if self.hasFlag(id=29) and self.queueSize(empty=true)
stopLastAnimation: true


[hiddenAction_时]
autoTriggerOnEvent: created
addResources: 超时空计时=180
showMessageToAllEnemyPlayers_zh: 系统警告：玩家：%{self.playerName}，队伍：%{self.teamName}，超时空传送仪已放置完成
showMessageToAllEnemyPlayers: System warning: Allied Chronosphere has been placed! Player: %{self.playerName}, team: %{self.teamName}.


[hiddenAction_倒计时] 
autoTrigger: if not self.resource(type='超时空计时', empty=true) and self.resource(type="电力",greaterThan=0)
addResources: 超时空计时=-1


[hiddenAction_倒计时2] 
autoTrigger: if self.resource(type='超时空计时', equalTo=60) and self.resource(type="电力",greaterThan=0)
showMessageToAllEnemyPlayers_zh: 系统警告：玩家：%{self.playerName}，队伍：%{self.teamName}，超时空传送仪倒计时还剩60秒启动
showMessageToAllEnemyPlayers: System warning: Allied Chronosphere countdown with 60 seconds left! Player: %{self.playerName}, team: %{self.teamName}.


[hiddenAction_重置计时] 
requireConditional: if numberOfUnitsInTeam(withTag='超时空传送仪', lessThan=1)
autoTriggerOnEvent: destroyed
resourceAmount: 超时空计时
resourceAmount_setValue: 0


[hiddenAction_重置计时2] 
autoTrigger: if not self.resource(type='入侵计时', empty=true)
showMessageToPlayer_zh: 系统警告：超时空传送仪倒计时被重置
showMessageToPlayer: System warning: Allied Chronosphere countdown has been reset!
showMessageToAllEnemyPlayers_zh: 系统提示：%{self.teamName}队的%{self.playerName}，超时空传送仪倒计时已经被重置
showMessageToAllEnemyPlayers: System hint: Allied Chronosphere countdown has been reset. Player: %{self.playerName}, team: %{self.teamName}.
playSoundGlobally: ROOT:\音频\语音+音效\uwarning.wav
autoTriggerOnEvent: teamChanged
resourceAmount: 超时空计时
resourceAmount_setValue: 180
alsoTriggerAction: 重置计时3


[hiddenAction_重置计时3]
resourceAmount: 入侵计时
resourceAmount_setValue: 0


[hiddenAction_1] 
autoTrigger: if self.resource(type='超时空计时', equalTo=1) and self.queueSize(empty=true)
showMessageToPlayer_zh: 系统提示：超时空传送仪已经启动
showMessageToPlayer: System hint: Allied Chronosphere is ready.
showMessageToAllEnemyPlayers_zh: 系统警告：玩家：%{self.playerName}，队伍：%{self.teamName}，超时空传送仪已经启动
showMessageToAllEnemyPlayers: System warning: Allied Chronosphere countdown is ready! Player: %{self.playerName}, team: %{self.teamName}.
playSoundGlobally: ROOT:\音频\语音+音效\schropen.wav
addResources: setFlag=10


[hiddenAction_2]
autoTrigger: if self.hasFlag(id=10) and self.resource(type="电力",greaterThan=0)
playAnimation: 活动动画


#[hiddenAction_2-1]
#autoTrigger: if self.hasFlag(id=10) and self.resource(type='超时空计时', greaterThan=0)
#stopLastAnimation: true
#addResources: unsetFlag=10


#[hiddenAction_3]
#autoTrigger: if not self.tags(includes='取消')
#temporarilyAddTags: 取消


[hiddenAction_停电]
autoTrigger: if not self.resource(type="电力",greaterThan=0) and not self.hasFlag(id=0) and self.hasFlag(id=10)
stopLastAnimation: true
playAnimation: 停电动画
addResources: setFlag=0


[hiddenAction_停电2]
autoTrigger: if (self.resource(type="电力",greaterThan=0) or not self.hasFlag(id=10)) and self.hasFlag(id=0)
stopLastAnimation: true
addResources: unsetFlag=0
#temporarilyAddTags: 触发


[hiddenAction_内部人员]
requireConditional: if self.globalTeamTags(includes='盟军')
autoTriggerOnEvent: destroyed
spawnUnits: 防卫大兵*2(offsetRandomX=30, offsetRandomY=30, skipIfOverlapping=true)


[hiddenAction_内部人员2]
requireConditional: if self.globalTeamTags(includes='苏联')
autoTriggerOnEvent: destroyed
spawnUnits: 动员兵*2(offsetRandomX=30, offsetRandomY=30, skipIfOverlapping=true)


[action_传送]
iconImage: ROOT:盟军\单位图标\超时空传送.png
text: Ready
text_zh: 已就绪
description: Please click the vehicle you want to deliver.\nAlso effective against friendly forces or enemies.
description_zh: 设置传送的对象，只能传送地面装甲单位\n可传送友军和敌方的单位
isVisible: if not self.hasFlag(id=1) and self.queueSize(empty=true) and self.resource(type='超时空计时', empty=true) and self.resource(type="电力",greaterThan=0)
buildSpeed: 0s
displayType: rally
fireTurretXAtGround: 传送
addResources: setFlag=1
temporarilyRemoveTags: 取消
isGuiBlinking: if self.queueSize(empty=true)


[hiddenAction_Ai传送]
autoTrigger: if self.isControlledByAI() and not self.hasUnitInTeam(withTag='超时空引子') and not numberOfUnitsInNeutralTeam(withTag='超时空传送', greaterThan=0) and not self.hasUnitInTeam(withTag='超时空传送') and self.hasUnitInTeam(withTag='车厂') and not self.hasFlag(id=1) and self.queueSize(empty=true) and self.resource(type='超时空计时', empty=true) and self.resource(type="电力",greaterThan=0)
temporarilyRemoveTags: 取消
spawnUnits: 超时空引子-Ai
#showMessageToAllPlayers: ＋超时空引子


[action_传送2]
iconImage: ROOT:盟军\单位图标\超时空传送.png
text: Location
text_zh: 传送地点
description: Please click the location you want to deliver.\nAttention, try to choose an open place.
description_zh: 设置传送到达的地点，尽量选择开阔的地面\n敌人的话随便了
isVisible: if self.hasFlag(id=1) and self.queueSize(empty=true) and self.resource(type="电力",greaterThan=0)
buildSpeed: 0s
displayType: rally
fireTurretXAtGround: 传送2
addResources: unsetFlag=1, unsetFlag=10, 超时空计时=180
isGuiBlinking: if self.queueSize(empty=true)
alsoQueueAction: 增加取消


[hiddenAction_Ai传送2]
autoTrigger: if self.isControlledByAI() and self.hasFlag(id=1) and self.queueSize(empty=true) and self.resource(type="电力",greaterThan=0) and self.globalTeamTags(includes='Ai传送')
addResources: unsetFlag=1, unsetFlag=10, 超时空计时=180
removeGlobalTeamTags: Ai传送
alsoQueueAction: 增加取消
#showMessageToAllPlayers: -Ai传送-仪器


[hiddenAction_增加取消]
buildSpeed: 1s
temporarilyAddTags: 取消


[action_取消]
text: Cancel
text_zh: 取消传送
description: Reset
description_zh: 重置
isVisible: if self.hasFlag(id=1)
buildSpeed: 0s
addResources: unsetFlag=1
temporarilyAddTags: 取消


#[hiddenAction_准备音效] 
#autoTrigger: if self.queueSize(empty=true) and self.resource(type="电力",greaterThan=0)
#playSoundAtUnit: ROOT:\音频\语音+音效\schrlo5a.wav, ROOT:\音频\语音+音效\schrlo5b.wav, ROOT:\音频\语音+音效\schrlo5c.wav


[animation_活动动画]
body_0s: {frame:1}
body_1.1s: {frame:6}


[animation_停电动画]
body_0s: {frame:3}
body_99999s: {frame:3}


[effect_电力]
#scaleFrom:2.5
#scaleTo:2.5
xOffsetRelative: -25
yOffsetRelative: 20


[effect_土坑2]
xOffsetRelativeRandom: 80
yOffsetRelativeRandom: 40


[effect_炸毁]
image: ROOT:\共享文件\1类\炸毁.png
scaleFrom: 2.5
scaleTo: 2.5
total_frames: 8
animateFrameStart: 0
animateFrameEnd: 7
animateFrameSpeed: 0.2
xOffsetRelative	:  0
yOffsetRelative	:  -10
xOffsetRelativeRandom:  10
yOffsetRelativeRandom:  5
alwayStartDirAtZero: true
fadeInTime: 0
fadeOut: false
drawUnderUnits:false


[effect_炸毁2]
@copyFromSection: effect_炸毁
xOffsetRelative	:  35
yOffsetRelative	:  -25


[effect_炸毁3]
@copyFromSection: effect_炸毁
xOffsetRelative	:  -35
yOffsetRelative	:  5


[global_resource_超时空计时]
displayName: Chronosphere countdown
displayName_zh: 超时空传送倒计时
displayColor: #FFFFFFFF


[template_zijin]
price: 3000
@global dianli: -200

[template_price]
price: 3000


#[ai]
#noneInBaseExtraPriority:0.10
#noneGlobalExtraPriority:0.10
#maxGlobal: 1