[core]
@global baseDamage: 20
@global levelDamage: 1
@global baseHP: 50
@global levelHP: 5

@global timeAlive: 15
@global hpStateRatio: 0.3
@global attackStateRatio: 0.2

@global baseAttack1: 100
name: smallSummon
displayText: smallSummon

copyFrom: ROOT:/MOBA/.MobaDATA/unitCommon.template, ROOT:/Moba/.MobaDATA/stats.template, ROOT:/Moba/.MobaDATA/skill1.template

isUnselectable: false
showOnMinimap:true
isUnselectableAsTarget: false
canNotBeDamaged:false
canNotBeDirectlyAttacked:false
energyMax: 1

price: Gold = 1
maxHp: 0
mass: 100000

techLevel: 1

tags: summon, 步兵轻甲, S

radius: 10
uiTargetRadius: 15
disableAllUnitCollisions: false
isBuilding: false

fogOfWarSightRange: 15


[graphics]
image_offsetY:0
total_frames: 14
image: smallSummon.png
image_wreak:  NONE
image_turret: NONE
image_shadow: AUTO_ANIMATED
scaleImagesTo: 128

shadowOffsetX:0
shadowOffsetY:10
animation_idle_start: 0
animation_idle_end: 9
animation_idle_speed: 5
animation_moving_start: 0
animation_moving_end: 9
animation_moving_speed: 5
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false
animation_direction_units: 180
animation_direction_strideX:0
animation_direction_strideY:2
animation_direction_starting:360
frame_width:  128
frame_height: 128


[attack]
canAttack: true
canAttackFlyingUnits: true
canAttackLandUnits:   true
canAttackUnderwaterUnits: true
isFixedFiring: true

turretSize: 0
turretTurnSpeed: 999
isMelee: true

maxAttackRange: 120
shootDelay: 1s

[turret_skillAttack]
invisible: true
x: 0
y:0
idleDir:0
shoot_sound:smallSummonAttack.ogg
shoot_sound_vol:0.3
projectile: skillAttack

turnSpeed:99999

turnSpeedAcceleration:999

[projectile_skillAttack]
directDamage:${baseAttack1}
image: summonProjectile.png
drawSize: 0.85
life: 60
tags:attack1
speed:24
buildingDamageMultiplier:0.25

[movement]
movementType: HOVER
moveSpeed: 1.2
moveAccelerationSpeed: 20
moveDecelerationSpeed: 20
maxTurnSpeed: 50
turnAcceleration: 50
moveSlidingMode :false
moveIgnoringBody:false
reverseSpeedPercentage:0
joinsGroupFormations: false

[hiddenAction_setUp]
autoTriggerOnEvent:created
requireConditional: if customTarget1.tags(includes = 'NecrotMancer')
alsoTriggerAction: initialize

[hiddenAction_setUp2]
autoTriggerOnEvent:created
requireConditional: if customTarget1.tags(includes = 'NecroMancerPortal')
setCustomTarget1: customTarget1.customTarget1
alsoTriggerAction: initialize

[hiddenAction_initialize]
autoTriggerOnEvent:IGNORE
setResourcesWithLogic: """
TotalMaxHP = (${baseHP} + ${levelHP} * (customTarget1.resource.Level-2)) + customTarget1.resource.TotalMaxHP * ${hpStateRatio}, 
TotalHPRegen = customTarget1.resource.TotalHPRegen * ${hpStateRatio}, 
TotalDefence = customTarget1.resource.TotalDefence, 
TotalMovementSpeed = customTarget1.resource.TotalMovementSpeed,
TotalAttackSpeed = customTarget1.resource.TotalAttackSpeed, 
TotalAttackPower = (${baseDamage} + ${levelDamage} * (customTarget1.resource.Level-2)) + customTarget1.resource.TotalAttackPower * ${attackStateRatio}, 
TotalLifeSteal = customTarget1.resource.TotalLifeSteal,
TotalCriticalChance = customTarget1.resource.TotalCriticalChance,
TotalCriticalPower = customTarget1.resource.TotalCriticalPower,
TotalSkillPower = customTarget1.resource.TotalSkillPower * ${attackStateRatio},
TotalSkillHaste = customTarget1.resource.TotalSkillHaste,
TotalSkillVamp = customTarget1.resource.TotalSkillVamp
"""
playSoundAtUnit: smallSummonSpawn.ogg:0.15
alsoTriggerAction: initializeNext, initialize1

[hiddenAction_initializeNext]
setUnitStats: """
maxHp = self.resource.TotalMaxHP, 
selfRegenRate = self.resource.TotalHPRegen/60, 
armour = self.resource.TotalDefence, 
moveSpeed = self.resource.TotalMovementSpeed*1.2/200,
shootDamageMultiplier = (self.resource.TotalAttackPower + self.resource.TotalSkillPower) * (1 + select(self.resource.TotalCriticalChance > 1, 1, self.resource.TotalCriticalChance) * (self.resource.TotalCriticalPower-1)) / 100, 
shootDelayMultiplier = 1 / self.resource.TotalAttackSpeed
"""
alsoTriggerAction: fullHP

[hiddenAction_fullHP]
setUnitStats: hp = self.maxHp()

[hiddenAction_initialize1]
autoTriggerOnEvent: IGNORE
setUnitStats: IGNORE
setResourcesWithLogic: damage = (self.resource.AttackPower + self.resource.SkillPower)*(1+self.resource.CriticalChance*self.resource.CriticalPower)*${baseAttack1}/100

[hiddenAction_reciveLifeSteal1] 
autoTriggerOnEvent: newMessage(withTag='LifeSteal1')
requireConditional: if not (self.hp() == self.maxHp()) and (self.resource.TotalLifeSteal > 0)
setUnitStats: hp = self.hp() + self.resource.damage * self.resource.TotalLifeSteal

[hiddenAction_notify1] 
autoTriggerOnEvent: newMessage(withTag='LifeSteal1')

[hiddenAction_initialTargeting] 
autoTriggerOnEvent: created
clearAllWaypoints: true
addWaypoint_type: guard
addWaypoint_target_fromReference: customTarget1
addWaypoint_target_nearestUnit_team: own

[hiddenAction_retargeting1] 
autoTrigger: if numberOfUnitsInTeam(withTag='NecroMancerSkill3', greaterThan=0)
requireConditional: if not self.hasActiveWaypoint(type='attackmove')
alsoTriggerAction: retargeting2

[hiddenAction_retargeting2] 
clearAllWaypoints: true
addWaypoint_type: attackmove
addWaypoint_target_nearestUnit_tagged: 建筑轻甲, 建筑防甲, 建筑重甲
addWaypoint_target_nearestUnit_team: enemy

[hiddenAction_retargeting3] 
autoTrigger: if numberOfUnitsInTeam(withTag='NecroMancerSkill3', equalTo=0)
requireConditional: if not self.hasActiveWaypoint(type='guard')
alsoTriggerAction: initialTargeting

[hiddenAction_dead]
autoTrigger: if self.resource.timer >= ${timeAlive}
setUnitStats: energy = 0

[hiddenAction_timer]
autoTrigger: if numberOfUnitsInTeam(withTag='NecroMancerPortal', equalTo=0)
addResourcesWithLogic: timer = 1

[resource_timer]
hidden: false

[template_price]
price: 100