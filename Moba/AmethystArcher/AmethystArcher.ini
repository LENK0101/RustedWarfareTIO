[core]
copyFrom: ROOT:/Moba/.MobaDATA/heroCommon.template, ROOT:/Moba/AmethystArcher/voice/voice.template, Localization.template

@global hpPerLevel: 101
@global regenPerLevel: 0.11
@global defencePerLevel: 0.353
@global manaPerLevel: 35
@global manaRegenPerLevel: 0.13
@global attackPowerPerLevel: 2.95
@global attackSpeedPerLevel: 0.034
@global baseAttack1: 100
@global baseAttack2: 30
@global baseAttackSP: 135
@global attackRange: 10
#attackRange = LOL/60

@global passiveStackLimit: 5
@global passiveAttackSpeed: 0.08

tags: hero, AmethystArcher, 步兵轻甲, M

name: AmethystArcher
displayText: Amethyst Archer
displayDescription:The Archer.


[hiddenAction_initialize]
setResourcesWithLogic: """
MaxHP = 610, 
HPRegen = 0.7, 
Defence = 3, 
MaxMana = 280, 
ManaRegen = 1.4, 
MovementSpeed = 225,
AttackSpeed = 0.658, 
AttackPower = 59, 
LifeSteal = 0,
CriticalChance = 0, 
CriticalPower = 2, 
SkillPower = 0,
SkillHaste = 0,
SkillVamp = 0
"""

[graphics]
total_frames: 8
image_offsetY:-4
image: AmethystArcher.png
image_wreak:  NONE
image_turret: NONE
image_shadow: AUTO_ANIMATED
scaleImagesTo: 85

shadowOffsetX:0
shadowOffsetY:-2
animation_idle_start: 0
animation_idle_end: 3
animation_idle_speed: 5
animation_moving_start:8 
animation_moving_end: 15
animation_moving_speed: 5
lock_body_rotation_with_main_turret: true
drawLayer:experimentals
rotate_with_direction: false
animation_direction_units: 180
animation_direction_strideX:0
animation_direction_strideY:3
animation_direction_starting:360
frame_width:  64
frame_height: 64

#-----------Basic Attack-----------

[animation_Attack]
start: 16
end: 19
speed:4

[turret_baseAttack]
shoot_sound:basicAttack.ogg
shoot_sound_vol:0.65
canAttackCondition:if customTarget1.resource.moltenFang == 0 and customTarget1.resource.nightfireCrossbow == 0 and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
onShoot_playAnimation: Attack
onShoot_freezeBodyMovementFor: 0.25s
onShoot_triggerActions:attackVoice

[turret_baseAttackS]
canAttackCondition:if customTarget1.resource.moltenFang >= 1 and customTarget1.resource.nightfireCrossbow == 0 and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
onShoot_triggerActions:attackVoice

[turret_baseAttackL]
canAttackCondition:if customTarget1.resource.moltenFang == 0 and customTarget1.resource.nightfireCrossbow >= 1 and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
onShoot_triggerActions:attackVoice

[turret_baseAttackS+L]
canAttackCondition:if customTarget1.resource.moltenFang >= 1 and customTarget1.resource.nightfireCrossbow >= 1 and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
onShoot_triggerActions:attackVoice

[projectile_baseAttack]
directDamage:${baseAttack1}
life:150
instant:false
image: projectile.png
deflectionPower: 2
drawSize: 1.1
speed: 15

[turret_baseAttack2]
x: 0
y: 0
canAttackCondition:if customTarget1.resource.moltenFang == 0 and customTarget1.resource.nightfireCrossbow == 0 and self.resource.passive == ${passiveStackLimit} and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
attachedTo: baseAttack
linkDelayWithTurret: baseAttack
#slave: true
delay: 10s
warmup:10
shoot_sound:basicAttack.ogg
shoot_sound_vol:0.35
projectile: baseAttack2
onShoot_triggerActions:attackVoice

[turret_baseAttack2S]
x: 0
y: 0
copyFrom: baseAttack2
canAttackCondition:if customTarget1.resource.moltenFang >= 1 and customTarget1.resource.nightfireCrossbow == 0 and self.resource.passive == ${passiveStackLimit} and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
attachedTo: baseAttackS
linkDelayWithTurret: baseAttackS
projectile: baseAttack2S
onShoot_triggerActions:attackVoice

[turret_baseAttack2L]
x: 0
y: 0
copyFrom: baseAttack2
canAttackCondition:if customTarget1.resource.moltenFang == 0 and customTarget1.resource.nightfireCrossbow >= 1 and self.resource.passive == ${passiveStackLimit} and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
attachedTo: baseAttackL
linkDelayWithTurret: baseAttackL
projectile: baseAttack2L
onShoot_triggerActions:attackVoice

[turret_baseAttack2S+L]
x: 0
y: 0
copyFrom: baseAttack2
canAttackCondition:if customTarget1.resource.moltenFang >= 1 and customTarget1.resource.nightfireCrossbow >= 1 and self.resource.passive == ${passiveStackLimit} and self.resource.skill2Activate == 0 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
attachedTo: baseAttackS+L
linkDelayWithTurret: baseAttackS+L
projectile: baseAttack2S+L
onShoot_triggerActions:attackVoice


[projectile_baseAttack2]
directDamage: ${baseAttack2}
life:150
instant:false
image: projectile2.png
deflectionPower: 1
speed: 15

#--------------Attack & Skills--------------
#---------Attack---------
[action_basicAttack]
isVisible: if self.resource.inventoryState == 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer.png
text:Basic Attack
description:"""
Basic attack deal %{${baseAttack1}}% (%{self.resource.TotalAttackPower*${baseAttack1}/100}) damage, each basic attack increases the attack speed by 8%, stacking up to 5 times. Upon reaching the maximum stacks, every attack will fire an additional arrow that deals %{${baseAttack2}}% (%{(self.resource.TotalAttackPower)*${baseAttack2}/100}) damage. \n
-Level:%{self.resource.Level} \n
-HP: %{self.resource.TotalMaxHP} (%{self.resource.MaxHP} + %{self.resource.ExtraMaxHP})\n 
-HP Regen: %{self.resource.TotalHPRegen} (%{self.resource.HPRegen} + %{self.resource.ExtraHPRegen})\n
-Mana: %{self.resource.TotalMaxMana} (%{self.resource.MaxMana} + %{self.resource.ExtraMaxMana})\n
-Mana Regen: %{self.resource.TotalManaRegen} (%{self.resource.ManaRegen} + %{self.resource.ExtraManaRegen})\n 
-Defence: %{self.resource.TotalDefence} (%{self.resource.Defence} + %{self.resource.ExtraDefence})\n
-Attack Power: %{self.resource.TotalAttackPower} (%{self.resource.AttackPower} + %{self.resource.ExtraAttackPower})\n 
-Attack Speed: %{self.resource.TotalAttackSpeed} (%{self.resource.AttackSpeed} + %{self.resource.ExtraAttackSpeed})\n 
-Life Steal: %{self.resource.TotalLifeSteal*100}%\n
-Attack Range: %{self.resource.TotalMaxAttackRange}\n
-Skill Power: %{self.resource.TotalSkillPower}\n 
-Skill Haste: %{self.resource.TotalSkillHaste}\n 
-Skill Vamp: %{self.resource.TotalSkillVamp*100}%\n
-Critical Chance: %{self.resource.TotalCriticalChance*100}%\n 
-Critical Damage: %{self.resource.TotalCriticalPower*100}%\n 
-Movement Speed: %{self.resource.TotalMovementSpeed} (%{self.resource.MovementSpeed} + %{self.resource.ExtraMovementSpeed})\n
"""
pos:1
buildSpeed:0s
isAlsoViewableByAllies: true
isAlsoViewableByEnemies: true
addWaypoint_type: attack
addWaypoint_target_nearestUnit_maxRange: 260
addWaypoint_target_nearestUnit_team: enemy
addWaypoint_target_nearestUnit_tagged: 步兵轻甲, 步兵中甲,步兵重甲, 载具轻甲, 载具中甲,载具重甲, 建筑轻甲,建筑防甲, 建筑重甲
addWaypoint_target_mapMustBeReachable: true
addWaypoint_prepend: true
alsoTriggerAction:interruptRecall


#---Passive---
[hiddenAction_passive] 
autoTriggerOnEvent: newMessage(withTag='LifeSteal1')
requireConditional: if self.resource.skill2Activate == 0
resetCustomTimer: true
alsoTriggerAction: passive2

[hiddenAction_passive2] 
requireConditional: if self.resource.passive < ${passiveStackLimit}
addResources: passive = 1
alsoTriggerAction: initialize

[hiddenAction_resetPassive] 
autoTrigger: if self.customTimer >= 5 and self.resource.passive > 0
setResourcesWithLogic: passive = 0
alsoTriggerAction: initialize

#---Skill 1---
[action_skill1Description]
isLocked: true
isVisible: if self.resource.Level < 2 and self.resource.inventoryState == 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer1.png
text:Amethyst Arrow
description:Launches a magical arrow that detonates on impact, dealing %{${baseDamage1}}-%{${baseDamage1} + ${levelDamage1} * 16} (+%{${multiplierBasicAttack1}*100}% Attack Power) (+%{${multiplierSkillPower1}*100}% Skill Power) area damage and knocking back enemies. \nFor every 100 points of Skill Power, the arrow's flight distance increases by 25%. \n-Cool Down: ${cd1}s \n-Mana Cost: ${mana1}
pos:1

[action_skill1]
@global cd1: 13
@global cdLevel1: 0.4
@global baseDamage1:100
@global levelDamage1: 10
@global multiplierBasicAttack1: 1
@global multiplierSkillPower1: 3
@global mana1: 75
@global manaLevel1: 1

isVisible: if self.resource.Level >= 2 and self.resource.inventoryState == 0
isLocked: if memory.skillCD1 > 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer1.png
text:Amethyst Arrow (%{int(select(memory.skillCD1>0, memory.skillCD1+1, 0))})
description:Launches a magical arrow that detonates on impact, dealing %{${baseDamage1} + ${levelDamage1} * (self.resource.Level-2)} (+%{${multiplierBasicAttack1} * (self.resource.AttackPower + (self.resource.Level-1) * ${attackPowerPerLevel})}) (+%{${multiplierSkillPower1} * self.resource.SkillPower}) area damage and knocking back enemies. \nFor every 100 points of Skill Power, the arrow's flight distance increases by 25%. \n-Cool Down: %{self.resource.skill1CDCount}s \n-Mana Cost: %{${mana1} - ${manaLevel1}*(self.resource.Level-2)}
pos:1
buildSpeed:0s
clearAllWaypoints:true
fireTurretXAtGround:skill1
fireTurretXAtGround_withProjectile:skill1
alsoTriggerAction:interruptRecall, skill1Voice
playAnimation:skill

[turret_skill1]

x: 0
y: 0
onShoot_freezeBodyMovementFor: 0.5s
shoot_sound:skill1.ogg
shoot_sound_vol:0.8
shoot_flame:NONE
canAttackCondition: false
limitingRange:9999


[projectile_skill1]
directDamage:0
life:0
speed:0
drawSize:0
explodeOnEndOfLife:true
explodeEffect: NONE
spawnUnit:AmethystArcherSkill1(offsetDir=-0)

[animation_skill]
start: 17
end: 19
speed:5

#---Skill 2---
[action_skill2Description]
isLocked: true
isVisible: if self.resource.Level < 3 and self.resource.inventoryState == 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer2.png
text:Precision Empowerment
description:Enhances basic attack capabilities, increasing attack range by 20% and boosting basic attack damage by %{${baseBuff2}}-%{${baseBuff2} + ${levelBuff2} * 15} (+%{${multiplierSkillPower2}*100}% Skill Power). \nThis effect lasts for 5 seconds.\n -Cool Down: ${cd2}s \n-Mana Cost: ${mana2}
pos:1

[action_skill2]
@global cd2: 3
@global cdLevel2: 0
@global baseBuff2: 20
@global levelBuff2: 2
@global multiplierSkillPower2: 0.5
@global mana2: 50
@global manaLevel2: -1

isVisible: if self.resource.Level >= 3 and self.resource.inventoryState == 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer2.png
text:Precision Empowerment (%{int(select(memory.skillCD2>0, memory.skillCD2+1, 0))})
isLocked: if memory.skillCD2 > 0
isLockedAlt: if self.resource.skill2Activate == 1 or not (self.resource.passive == 5)
description:Enhances basic attack capabilities, increasing attack range by 20% and boosting basic attack damage by %{${baseBuff2} + ${levelBuff2} * (self.resource.Level-3)} (+%{${multiplierSkillPower2} * self.resource.SkillPower}). \nThis effect lasts for 5 seconds.\n -Cool Down: %{self.resource.skill2CDCount}s \n-Mana Cost: %{${mana2} - ${manaLevel2}*(self.resource.Level-3)}
pos:1
buildSpeed:0s
setUnitMemory: IGNORE
alsoTriggerAction: skill2On, interruptRecall, skill2Voice

[hiddenAction_skill2On]
setResourcesWithLogic: skill2Counter = 5, skill2Activate = 1
playSoundToPlayer: skill2.ogg:0.8
resetCustomTimer: true
alsoTriggerAction: initialize

[hiddenAction_skill2Off]
autoTrigger: if self.resource.skill2Activate == 1 and (self.resource.skill2Counter <= 0 or self.resource.passive == 0)
setResourcesWithLogic: skill2Activate = 0
setUnitMemory: skillCD2 = self.resource.skill2CDCount
alsoTriggerAction: initialize

[hiddenAction_skill2Off2] 
autoTriggerOnEvent: newMessage(withTag="LifeSteal1")
requireConditional: if self.resource.skill2Activate == 1 and self.resource.passive == 0 
setResourcesWithLogic: skill2Activate = 0
alsoTriggerAction: initialize

[hiddenAction_skill2Counter]
autoTrigger: if self.resource.skill2Counter > 0
addResourcesWithLogic: skill2Counter = -1

[resource_skill2Activate]
hidden: true

[resource_skill2Counter]
hidden: true

#---

[turret_baseAttackSP]
x: 0
y: 0
canAttackCondition:if customTarget1.resource.moltenFang == 0 and customTarget1.resource.nightfireCrossbow == 0 and self.resource.skill2Activate == 1 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
onShoot_playAnimation: Attack
onShoot_freezeBodyMovementFor: 0.25s
shoot_sound:enchantedBasicAttack.ogg
shoot_sound_vol:0.60
shoot_flame:NONE
shoot_light:#FFEECCCC
projectile: baseAttackSP
resourceUsage: passive = 1
onShoot_triggerActions:attackVoice


[turret_baseAttackSPS]
x: 0
y: 0
copyFrom: baseAttackSP
canAttackCondition:if customTarget1.resource.moltenFang >= 1 and customTarget1.resource.nightfireCrossbow == 0 and self.resource.skill2Activate == 1 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
projectile: baseAttackSPS
onShoot_triggerActions:attackVoice

[turret_baseAttackSPL]
x: 0
y: 0
copyFrom: baseAttackSP
canAttackCondition:if customTarget1.resource.moltenFang == 0 and customTarget1.resource.nightfireCrossbow >= 1 and self.resource.skill2Activate == 1 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
projectile: baseAttackSPL
onShoot_triggerActions:attackVoice

[turret_baseAttackSPS+L]
x: 0
y: 0
copyFrom: baseAttackSP
canAttackCondition:if customTarget1.resource.moltenFang >= 1 and customTarget1.resource.nightfireCrossbow >= 1 and self.resource.skill2Activate == 1 and numberOfUnitsInTeam(withTag='recallMark', equalTo=0)
projectile: baseAttackSPS+L
onShoot_triggerActions:attackVoice


[projectile_baseAttackSP]
@copyFromSection: projectile_baseAttack
directDamage:0
areaDamage: ${baseAttackSP}
areaRadius: 25
areaRadiusFromEdge: true
areaDamageNoFalloff: true
areaHitAirAndLandAtSameTime: true
largeHitEffect: true
life:120
instant:false
image: projectile.png
deflectionPower: 3
speed: 25
trailEffect: true
trailEffectRate: 1
drawSize: 1.2

[projectile_baseAttackSPS]
@copyFromSection: projectile_baseAttackS
directDamage:0
areaDamage: ${baseAttackSP}
areaRadius: 25
areaRadiusFromEdge: true
areaDamageNoFalloff: true
areaHitAirAndLandAtSameTime: true
largeHitEffect: true
life:120
instant:false
image: projectile.png
deflectionPower: 3
speed: 25
trailEffect: true
trailEffectRate: 1
drawSize: 1.2

[projectile_baseAttackSPL]
@copyFromSection: projectile_baseAttackL
directDamage:0
areaDamage: ${baseAttackSP}
areaRadius: 25
areaRadiusFromEdge: true
areaDamageNoFalloff: true
areaHitAirAndLandAtSameTime: true
largeHitEffect: true
life:120
instant:false
image: projectile.png
deflectionPower: 3
speed: 25
trailEffect: true
trailEffectRate: 1
drawSize: 1.2

[projectile_baseAttackSPS+L]
@copyFromSection: projectile_baseAttackS+L
directDamage:0
areaDamage: ${baseAttackSP}
areaRadius: 25
areaRadiusFromEdge: true
areaDamageNoFalloff: true
areaHitAirAndLandAtSameTime: true
largeHitEffect: true
life:120
instant:false
image: projectile.png
deflectionPower: 3
speed: 25
trailEffect: true
trailEffectRate: 1
drawSize: 1.2


#---Skill 3---
[action_skill3Description]
isLocked: true
isVisible: if self.resource.Level < 6 and self.resource.inventoryState == 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer3.png
text:Veil of Amethyst
description:Phases into the void for 2 seconds, becoming untargetable and immune to all damage. During this time, gains 60% movement speed, and get the ability to traverse any terrain, also regenerates %{${baseBuff3}}-%{${baseBuff3} + ${levelBuff3} * 12} (+${multiplierSkillPower3*100}% Skill Power) hp continuously. \nUpon leaving the void, her passive stack is fully replenished. \n-Cool Down: ${cd3}s \n-Mana Cost: ${mana3}
pos:1

[action_skill3]
@global cd3: 40
@global cdLevel3: 0.5
@global baseBuff3:100
@global levelBuff3: 10
@global multiplierSkillPower3: 1
@global mana3: 100
isVisible: if self.resource.Level >= 6 and self.resource.inventoryState == 0
isLocked: if memory.skillCD3 > 0
iconImage: ROOT:/MOBA/.MobaDATA/icon/skill/archer3.png
text:Veil of Amethyst (%{int(select(memory.skillCD3>0, memory.skillCD3+1, 0))})
description:Phases into the void for 2 seconds, becoming untargetable and immune to all damage. During this time, gains 60% movement speed, and get the ability to traverse any terrain, also regenerates %{${baseBuff3} + ${levelBuff3} * (self.resource.Level-6)} (+%{${multiplierSkillPower3} * self.resource.TotalSkillPower}) hp continuously. \nUpon leaving the void, her passive stack is fully replenished. \n-Cool Down: %{self.resource.skill3CDCount}s \n-Mana Cost: %{${mana3} - ${manaLevel3}*(self.resource.Level-6)}
pos:1
buildSpeed:0s
alsoTriggerAction: skill3On, interruptRecall, skill3Voice

[hiddenAction_skill3On]
setResourcesWithLogic: skill3Activate = 1
spawnUnits: AmethystArcherSkill3Mark
playSoundToPlayer: skill32.ogg:0.8
alsoTriggerAction: initialize, skill3On2

[hiddenAction_skill3On2]
convertTo:AmethystArcherSkill3
convertTo_keepCurrentTags: true
convertTo_keepCurrentFields: maxHp, maxShield, maxEnergy, shieldRegen, armour, shootDelayMultiplier, moveSpeed, maxAttackRange, selfRegenRate

[resource_skill3Activate]
hidden: false

#--------------Others--------------
[hiddenAction_updateSkill]
addResourcesWithLogic: """
AdditionalAttackSpeed = self.resource.passive * ${passiveAttackSpeed},
AdditionalAttackPower = select(self.resource.skill2Activate == 1 , ${baseBuff2} + ${levelBuff2} * (self.resource.Level-3) + ${multiplierSkillPower2} * self.resource.TotalSkillPower, 0),
AdditionalHPRegen = select(self.resource.skill3Activate == 1 , (${baseBuff3} + ${levelBuff3} * (self.resource.Level-6) + ${multiplierSkillPower3} * self.resource.TotalSkillPower)/2, 0),
BoostedMovementSpeed = select(self.resource.skill3Activate == 1, 0.6, 0),
BoostedAttackRange = select(self.resource.skill2Activate == 1, 0.2, 0)
"""

[hiddenAction_reciveLifeSteal1] 
requireConditional: if not (self.hp() == self.maxHp()) and (self.resource.TotalLifeSteal > 0) and self.resource.skill2Activate == 0
setUnitStats: hp = self.hp() + (self.resource.TotalAttackPower	+	select(self.resource.skill2Activate==1, ${baseBuff2} + ${levelBuff2} * (self.resource.Level-3) + ${multiplierSkillPower2} * self.resource.SkillPower, 0))*(1+self.resource.CriticalChance*(self.resource.CriticalPower-1))*${baseAttack1}*self.resource.LifeSteal/100

[hiddenAction_reciveLifeSteal2] 
requireConditional: if not (self.hp() == self.maxHp()) and (self.resource.TotalLifeSteal > 0) and self.resource.skill2Activate == 0
setUnitStats: hp = self.hp() + (self.resource.TotalAttackPower	+	select(self.resource.skill2Activate==1, ${baseBuff2} + ${levelBuff2} * (self.resource.Level-3) + ${multiplierSkillPower2} * self.resource.SkillPower, 0))*(1+self.resource.CriticalChance*(self.resource.CriticalPower-1))*${baseAttack2}*self.resource.LifeSteal/100

[hiddenAction_reciveLifeStealSP] 
autoTriggerOnEvent: newMessage(withTag="LifeSteal1")
requireConditional: if not (self.hp() == self.maxHp()) and (self.resource.TotalLifeSteal > 0) and self.resource.skill2Activate == 1
setUnitStats: hp = self.hp() + (self.resource.TotalAttackPower*(1+self.resource.CriticalChance*(self.resource.CriticalPower-1))) *${baseAttackSP}*self.resource.LifeSteal/100


[hiddenAction_gildedSerpentRingOn2]
convertTo: AmethystArcherGolden

[hiddenAction_convertAqua]
convertTo: AmethystArcherAqua

[resource_passive]
hidden:false


[template_customBar]
layer: beforeUI
order:1
onlyWhenSelectedByAnyPlayer:false
onlyOnNonPreview:true
alwaysStartDirAtZero:true
teamColors:false
onlyWhileAlive: true

[decal_passive]
@copyFromSection: template_customBar
@define totalFrames:5
isVisible: if self.resource.passive > 0 and self.hp > 0
image: ROOT:/Moba/AmethystArcher/Passive.png
frame_width:52
frame_height:4	
frame: int(self.resource.passive - 1)
teamColors:true
yOffsetAbsolute:-35
xOffsetAbsolute: -3

[decal_skill2]
@copyFromSection: template_customBar
isVisible: if self.resource.skill2Activate == 1
image: ROOT:/Moba/AmethystArcher/skill2.png
frame_width:64
frame_height:32
teamColors:true
yOffsetAbsolute:17
xOffsetAbsolute:0
layer: beforeBody
imageScale: 0.7
