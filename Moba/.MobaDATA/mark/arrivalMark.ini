[core]
copyFrom: ROOT:/Moba/.MobaDATA/skillCommon.template, ROOT:/MOBA/.MobaDATA/localization/arrivalMarkLocalization.template
name: arrivalMark
displayText: Arrival Stone
displayDescription: Teleport to a totem
energyMax:1
energyRegen:0
fogOfWarSightRange:0
tags: arrivalMark
autoTriggerCooldownTime:0.1s
autoTriggerCooldownTime_allowDangerousHighCPU: true
footprint: 0,0,0,0
constructionFootprint: 0,0,0,0
buildingSelectionOffset:0
techLevel: 1
buildSpeed: 0
selfBuildRate: 0s
radius: 0
displayRadius:0
isBuilding: true

[graphics]
image:        ROOT:/DATA/total/null.png
icon_build: ROOT:/MOBA/.MobaDATA/icon/Consumables/Arrival Stone.png

[movement]
movementType: NONE

[attack]
canAttack: false
canAttackFlyingUnits: false
canAttackLandUnits:   false
canAttackUnderwaterUnits: false
maxAttackRange: 0

[hiddenAction_init]
autoTriggerOnEvent: created
setResourcesWithLogic: arrivalCountDown = 30
sendMessageTo: customTarget1
sendMessageWithTags: arrivalSetup

[hiddenAction_countDown]
autoTrigger: if self.resource.arrivalCountDown > 0
addResourcesWithLogic: arrivalCountDown = -1

[hiddenAction_arrivalComplete]
autoTrigger: if self.resource.arrivalCountDown == 0 and self.resource.arrivalComplete == 0
sendMessageTo: customTarget1
sendMessageWithTags: arrivalComplete
sendMessageWithData: location = self.getAsMarker()
addResourcesWithLogic: arrivalComplete = 1

[hiddenAction_destroy1]
autoTrigger: if (customTarget1.resource.interruptRecall == 1 and self.timeAlive() >= 1) or self.timeAlive() > 4
setUnitStats: hp = -100

[resource_arrivalComplete]
hidden:true

[resource_interruptRecall]
hidden:true

[global_resource_arrivalCountDown]
hidden:true

[placementRule_arrival]
searchTeam: own
searchTags: totem
searchDistance: 100
cannotPlaceMessage: "You can only teleport to totem!"
minCount: 1


[template_customBar]
layer: beforeUI
order:1
onlyWhenSelectedByAnyPlayer:false
onlyOnNonPreview:true
alwaysStartDirAtZero:true
teamColors:false
onlyWhileAlive: true

[decal_arrivalback]
@copyFromSection: template_customBar
layer: beforeBody
image: ROOT:/Moba/.MobaDATA/effect/arrival_back.png
frame_width:48
frame_height:48
isVisible: if numberOfUnitsInTeam(withTag='arrivalMark', equalTo=1) and self.resource.arrivalCountDown > 0
frame: (self.resource.arrivalCountDown - 10 * int((self.resource.arrivalCountDown - 1)/10)) - 1
yOffsetAbsolute:0
xOffsetAbsolute:0
imageScale: 2

[decal_arrivalFront]
@copyFromSection: template_customBar
layer: afterBody
image: ROOT:/Moba/.MobaDATA/effect/arrival_front.png
frame_width:48
frame_height:48
isVisible: if numberOfUnitsInTeam(withTag='arrivalMark', equalTo=1) and self.resource.arrivalCountDown > 0
frame: (self.resource.arrivalCountDown - 10 * int((self.resource.arrivalCountDown - 1)/10)) - 1
yOffsetAbsolute:0
xOffsetAbsolute:0
imageScale: 2